<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Load Balancing and Clustering - my read books</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../books.html"><strong aria-hidden="true">1.</strong> Books</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../books/google-software-engineering.html"><strong aria-hidden="true">1.1.</strong> Google Software Engineering</a></li><li class="chapter-item expanded "><a href="../books/clean-architecture.html"><strong aria-hidden="true">1.2.</strong> Clean Architecture</a></li></ol></li><li class="chapter-item expanded "><a href="../system-design-interview.html"><strong aria-hidden="true">2.</strong> System Design Interview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../system-design-interview/introduction.html"><strong aria-hidden="true">2.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../system-design-interview/ip-osimodel.html"><strong aria-hidden="true">2.2.</strong> IP DNS and TCP/UDP</a></li><li class="chapter-item expanded "><a href="../system-design-interview/loadblancer-clustering.html" class="active"><strong aria-hidden="true">2.3.</strong> Load Balancing and Clustering</a></li><li class="chapter-item expanded "><a href="../system-design-interview/cache-cdn.html"><strong aria-hidden="true">2.4.</strong> Cache and CDN</a></li><li class="chapter-item expanded "><a href="../system-design-interview/databases.html"><strong aria-hidden="true">2.5.</strong> Databases</a></li><li class="chapter-item expanded "><a href="../system-design-interview/url-shortener-service.html"><strong aria-hidden="true">2.6.</strong> System Design of URL Shourtener Service</a></li></ol></li><li class="chapter-item expanded "><a href="../videos.html"><strong aria-hidden="true">3.</strong> Videos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../videos/how-greate-leaders-inspire-action.html"><strong aria-hidden="true">3.1.</strong> How greate leaders inspire action?</a></li></ol></li><li class="chapter-item expanded "><a href="../dev-tips.html"><strong aria-hidden="true">4.</strong> Dev-tips</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dev-tips/git-communications.html"><strong aria-hidden="true">4.1.</strong> Git Commuincations</a></li><li class="chapter-item expanded "><a href="../dev-tips/mercari-ladders.html"><strong aria-hidden="true">4.2.</strong> Mercari Engeneer Ladders</a></li></ol></li><li class="chapter-item expanded "><a href="../health.html"><strong aria-hidden="true">5.</strong> Health</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../health/training.html"><strong aria-hidden="true">5.1.</strong> training</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">my read books</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="system-design-basics"><a class="header" href="#system-design-basics">System Design basics</a></h1>
<p>From <a href="https://github.com/karanpratapsingh/system-design">karanpratapsignh/system-design</a></p>
<h2 id="なぜload-balancingが必要なのか"><a class="header" href="#なぜload-balancingが必要なのか">なぜLoad Balancingが必要なのか？</a></h2>
<ul>
<li>膨大なトラフィックを、複数台のサーバーを使って効率的に処理するため。</li>
<li>単一障害点をなくし、可用性を向上させるため。</li>
</ul>
<h3 id="どうやってトラフィックを分散させているのか"><a class="header" href="#どうやってトラフィックを分散させているのか">どうやってトラフィックを分散させているのか？</a></h3>
<ul>
<li>Host-based: ホスト名に基づいて分散させる方法。</li>
<li>Path-based: URLに基づいて分散させる方法。</li>
<li>Content-based: リクエストのメッセージ内容を元に分散させる方法。</li>
</ul>
<h3 id="ロードバランサーはosiモデルのどの層で行うべきか"><a class="header" href="#ロードバランサーはosiモデルのどの層で行うべきか">ロードバランサーはOSIモデルのどの層で行うべきか？</a></h3>
<h4 id="network-layer"><a class="header" href="#network-layer">Network Layer</a></h4>
<p>いわゆるL4ロードバランサーのこと。
OSIモデルの４層目にあたるネットワーク転送レイヤーにて、ネットワークに関する情報（IPアドレスなど）を用いて、ルーティングを行う。
この時点では、データの内容を解釈することはできないため、コンテンツベースのルーティングはできない。</p>
<p>e.g. CLB, NLB (AWS)</p>
<h4 id="application-layer"><a class="header" href="#application-layer">Application Layer</a></h4>
<p>いわゆるL7ロードバランサーのこと。
OSIモデルの7層目に当たるアプリケーションレイヤーにて、コンテンツベース（クッキーなど）のルーティングを行う。
ロードバランサーを使ったセッションの維持はL7ロードバランサーじゃないとできない。</p>
<p>e.g. CLB, ALB (AWS)</p>
<h3 id="ロードバランサーにはどんな種類があるか"><a class="header" href="#ロードバランサーにはどんな種類があるか">ロードバランサーにはどんな種類があるか？</a></h3>
<h4 id="softwareタイプ"><a class="header" href="#softwareタイプ">Softwareタイプ</a></h4>
<p>最も一般的なタイプ。NginXとか。</p>
<h4 id="hardwareタイプ"><a class="header" href="#hardwareタイプ">Hardwareタイプ</a></h4>
<p>オンプレミスでデバイスを設置して使うタイプ。あまり聞かないけど</p>
<h4 id="dnsタイプ"><a class="header" href="#dnsタイプ">DNSタイプ</a></h4>
<p>IPアドレスを返してそこへアクセスさせる方法。DNSは転送先の状態を確認しないため、不便。あまり使われていない。</p>
<h3 id="routing-algorithms"><a class="header" href="#routing-algorithms">Routing Algorithms</a></h3>
<ul>
<li><strong>Round-robin</strong>: ローテーション方式で転送先を決める。</li>
<li><strong>Weighted Round-robin</strong>: サーバーの性能に応じて重み付けしてローテーションする方式。</li>
<li><strong>Least Connections</strong>: コネクションが少ないサーバーに優先的に転送する方式。</li>
<li><strong>Lease Response Time</strong>: レスポンスが早いサーバーに優先的に転送する方式。</li>
<li><strong>Least Bandwidth</strong>: トラフィックが少ないサーバーに優先的に転送する方式。</li>
<li><strong>Hashing</strong>: こちらが独自に定義したキーに応じて振り分ける方式(IPアドレスやリクエストURLなど)。</li>
</ul>
<h3 id="ロードバランサーの冗長性redundancyは大丈夫そう"><a class="header" href="#ロードバランサーの冗長性redundancyは大丈夫そう">ロードバランサーの冗長性（Redundancy）は大丈夫そう？</a></h3>
<p>単一のロードバランサーは単一障害点になる。
クラスターモードでロードバランサーを運用し、本体が死んだら待機しているロードバランサーに切り替えるなどの対応が可能。</p>
<h3 id="ロードバランサーの要件とは"><a class="header" href="#ロードバランサーの要件とは">ロードバランサーの要件とは？</a></h3>
<ul>
<li>トラフィックに応じてサーバーリソースのオートスケールが可能であること。</li>
<li>セッションを保持できること（同じユーザーのアクセスは同じサーバーに転送する）。</li>
<li>サーバーのヘルスチェックが可能であること。</li>
<li>Webソケットのようなパーシステントコネクションが可能であること。</li>
<li>TLSやSSLのような暗号化処理を行うことができること。</li>
<li>接続元の認証が可能であること。</li>
<li>レスポンスを圧縮できること。</li>
<li>L7ロードバランサーなどは、キャッシュが可能であること。</li>
<li>ロギングが可能であること。</li>
<li>リクエストトレースが可能であること。リクエストごとにユニークなIDを振り分けてログをとる。</li>
<li>リダイレクトが可能であること。</li>
<li>固定レスポンスができること（エラーメッセージ的な）。</li>
</ul>
<h3 id="サービス例"><a class="header" href="#サービス例">サービス例</a></h3>
<ul>
<li>Amazon ELB</li>
<li>Azure Load Balancing</li>
<li>GCP Load Balancing</li>
<li>Nginx</li>
</ul>
<h2 id="なぜclusteringが必要なのか"><a class="header" href="#なぜclusteringが必要なのか">なぜClusteringが必要なのか？</a></h2>
<p>複数のコンピュータリソースにまたがって処理を分散的に行うことで、より効率的に、スピーディに処理を行うため。</p>
<p>一台のノードがリーダー的な役割を果たし、他のノードのエントリーポイントとして動作していることが一般的。
リーダーノードが処理を他ノードに分散して行わせたり、処理結果を集約してユーザーに返す処理を行う。</p>
<h3 id="クラスターの種類"><a class="header" href="#クラスターの種類">クラスターの種類</a></h3>
<ul>
<li><strong>Highly available or fail-over</strong> (クラスターノードに障害が発生した場合に他のノードがサービスを提供する。Kubernetes的な？)</li>
<li><strong>ロードバランシング</strong></li>
<li><strong>ハイパフォーマンスコンピューティング</strong></li>
</ul>
<h3 id="high-availavilityのクラスター設定例"><a class="header" href="#high-availavilityのクラスター設定例">High Availavilityのクラスター設定例</a></h3>
<h4 id="active-active"><a class="header" href="#active-active">active-active</a></h4>
<pre class="mermaid">%%{init:{'theme':'neutral'}}%%

flowchart LR
  Client --&gt; LoadBalancer
  subgraph cluster
    Node1
    Node2
  end
  LoadBalancer --&gt; Node1
  LoadBalancer --&gt; Node2
</pre>
<h4 id="active-passive"><a class="header" href="#active-passive">active-passive</a></h4>
<pre class="mermaid">%%{init:{'theme':'neutral'}}%%

flowchart LR
  Client --&gt; LoadBalancer
  subgraph cluster LR
    Node1_Primary
    Node2_FailOver
  end
  LoadBalancer --&gt; Node1_Primary
  Node1_Primary -.-&gt; Node2_FailOver
</pre>
<h3 id="クラスタリングを用いたコンピューティングのメリットとは"><a class="header" href="#クラスタリングを用いたコンピューティングのメリットとは">クラスタリングを用いたコンピューティングのメリットとは？</a></h3>
<ul>
<li>高可用性</li>
<li>スケーラビリティ</li>
<li>パフォーマンス</li>
<li>コスト効率</li>
</ul>
<h3 id="クラスタリングを用いる場合のデメリットは"><a class="header" href="#クラスタリングを用いる場合のデメリットは">クラスタリングを用いる場合のデメリットは？</a></h3>
<ul>
<li>複雑性のメンテナンスの難しさ。</li>
</ul>
<h3 id="サービス例-1"><a class="header" href="#サービス例-1">サービス例</a></h3>
<ul>
<li>Containers (e.g. Kubernetes, Amazon ECS)</li>
<li>Databases (e.g. Cassandra, MongoDB)</li>
<li>Cashe (e.g. Redis)</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../system-design-interview/ip-osimodel.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../system-design-interview/cache-cdn.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../system-design-interview/ip-osimodel.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../system-design-interview/cache-cdn.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>
    </body>
</html>
